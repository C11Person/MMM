<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.appsys.dao.DevMapper">


	<select id="selectUserByNameAndPwd" resultType="DevUser">
		SELECT id,devCode,devName,devPassword FROM dev_user 

		<where>
			and devCode=#{devCode} and devPassword=#{devPassword}
		</where>
	</select>
	
	
	<select id="appList" resultType="AppInfo">
		SELECT 	app_info.id,softwareName,APKName,softwareSize,flatformId,d1.valueName AS flatformName,categoryLevel1,a1.categoryName AS categoryLevel1Name,categoryLevel2,a2.categoryName AS categoryLevel2Name,categoryLevel3,a3.categoryName AS categoryLevel3Name,STATUS,d2.valueName AS statusName,downloads,versionId,versionNo FROM app_info 
		INNER JOIN data_dictionary  AS d1 ON d1.valueId = app_info.flatformId
		INNER JOIN data_dictionary AS d2 ON d2.valueId = app_info.status
		INNER JOIN app_category AS a1 ON a1.id =app_info.categoryLevel1
		INNER JOIN app_category AS a2 ON a2.id =app_info.categoryLevel2
		INNER JOIN app_category AS a3 ON a3.id =app_info.categoryLevel3
		INNER JOIN app_version ON app_version.id = app_info.versionId
 	
		where	d1.typeName='所属平台' AND d2.typeName='APP状态'
			
			<if test="softwareName!=null and softwareName!=''">
				and softwareName like concat('%',#{softwareName},'%')
			</if>
			<if test="STATUS!=0">
				and STATUS = #{STATUS}
			</if>
			<if test="flatformId!=0">
				and flatformId = #{flatformId}
			</if>
			<if test="categoryLevel1!=0">
				and categoryLevel1 =#{categoryLevel1}
			</if>
			<if test="categoryLevel2!=0">
				and categoryLevel2 =  #{categoryLevel2}
			</if>
			<if test="categoryLevel3!=0">
				and categoryLevel3 = #{categoryLevel3}
			</if>
			limit #{index},#{pageSize}
	</select>
	
	<select id="selectAppCount" resultType="int">
		SELECT COUNT(1) AS count FROM app_info
		INNER JOIN data_dictionary  AS d1 ON d1.valueId = app_info.flatformId
		INNER JOIN data_dictionary AS d2 ON d2.valueId = app_info.status
		INNER JOIN app_category AS a1 ON a1.id =app_info.categoryLevel1
		INNER JOIN app_category AS a2 ON a2.id =app_info.categoryLevel2
		INNER JOIN app_category AS a3 ON a3.id =app_info.categoryLevel3
		INNER JOIN app_version ON app_version.id = app_info.versionId
 	
		where	d1.typeName='所属平台' AND d2.typeName='APP状态'
			
			<if test="softwareName!=null and softwareName!=''">
				and softwareName like concat('%',#{softwareName},'%')
			</if>
			<if test="STATUS!=0">
				and STATUS = #{STATUS}
			</if>
			<if test="flatformId!=0">
				and flatformId = #{flatformId}
			</if>
			<if test="categoryLevel1!=0">
				and categoryLevel1 =#{categoryLevel1}
			</if>
			<if test="categoryLevel2!=0">
				and categoryLevel2 =  #{categoryLevel2}
			</if>
			<if test="categoryLevel3!=0">
				and categoryLevel3 = #{categoryLevel3}
			</if>
	</select>
	
	<select id="statusList" resultType="DataDictionary">
		SELECT 	id,typeCode,typeName,valueId,valueName FROM data_dictionary where typeName='APP状态'
	</select>
	
	<select id="flatFormList" resultType="DataDictionary">
		SELECT 	id,typeCode,typeName,valueId,valueName FROM data_dictionary where typeName='所属平台'
	</select>
	
	<!-- 一级分类 -->
	<select id="categoryLevel1List" resultType="AppCategory">
		SELECT id,categoryName,parentId FROM app_category  WHERE parentId IS NULL
	</select>
	
	<!-- 二三级分类 -->
	<select id="categoryLevel2List" resultType="AppCategory" >
	  	SELECT id,categoryName,parentId FROM app_category WHERE parentId=#{id}
	 </select>

</mapper>